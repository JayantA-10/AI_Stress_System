{% extends "base.html" %}
{% block title %}Counselor Dashboard â€” StressAI{% endblock %}
{% block content %}
<div class="container">
  <div class="page-header">
    <h1>Counselor Dashboard</h1>
    <p>All students listed below â€” high risk cases appear first.</p>
  </div>

  {# â”€â”€ Summary Stats â”€â”€ #}
  <div class="grid-3" style="margin-bottom:1rem">
    <div class="card">
      <div class="card-title">Total Students</div>
      <div class="stat-value">{{ student_data | length }}</div>
      <div class="stat-label">registered</div>
    </div>
    <div class="card">
      <div class="card-title">High Risk</div>
      <div class="stat-value" style="color:var(--high)">{{ high_risk_count }}</div>
      <div class="stat-label">need attention now</div>
    </div>
    <div class="card">
      <div class="card-title">Active Alerts</div>
      <div class="stat-value" style="color:var(--mod)">{{ alert_count }}</div>
      <div class="stat-label">alerts triggered</div>
    </div>
  </div>

  {# â”€â”€ Alert Banner â”€â”€ #}
  {% if high_risk_count > 0 %}
  <div class="alert-banner">
    <span style="font-size:1.2rem">ğŸš¨</span>
    <div>
      <strong>{{ high_risk_count }} student(s) at high risk.</strong>
      Please review and consider outreach â€” they are listed first below.
    </div>
  </div>
  {% endif %}

  {# â”€â”€ Student Table â”€â”€ #}
  <div class="card">
    <div class="card-title">All Students</div>
    {% if student_data %}
    <table>
      <thead>
        <tr>
          <th>Student</th>
          <th>Stress Level</th>
          <th>Burnout Risk</th>
          <th>Alert</th>
          <th>Last Check-in</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for s in student_data %}
        <tr>
          <td>
            <div style="font-weight:500">{{ s.username }}</div>
            <div style="font-size:0.78rem; color:var(--muted)">{{ s.email }}</div>
          </td>
          <td>
            {% if s.latest %}
              <span class="badge badge-{{ s.latest.stress_prediction | lower }}">{{ s.latest.stress_prediction }}</span>
            {% else %}
              <span class="badge badge-none">No data</span>
            {% endif %}
          </td>
          <td>
            {% if s.latest %}
            <div style="display:flex; align-items:center; gap:0.5rem">
              <div class="progress-wrap" style="width:75px">
                <div class="progress-bar pb-{{ s.latest.stress_prediction | lower }}" style="width:{{ s.latest.burnout_risk }}%"></div>
              </div>
              <span style="font-size:0.82rem">{{ s.latest.burnout_risk | int }}%</span>
            </div>
            {% else %}â€”{% endif %}
          </td>
          <td>
            {% if s.latest and s.latest.alert_sent %}
              <span class="badge" style="background:var(--high-bg); color:var(--high)">âš ï¸ Alert</span>
            {% else %}
              <span style="color:var(--muted); font-size:0.82rem">â€”</span>
            {% endif %}
          </td>
          <td style="color:var(--muted); font-size:0.84rem">
            {% if s.latest %}{{ s.latest.created_at.strftime("%b %d, %Y") }}{% else %}â€”{% endif %}
          </td>
          <td>
            {% if s.latest %}
            <a href="{{ url_for('student_detail', user_id=s.id) }}"
               style="font-size:0.82rem; color:var(--accent); text-decoration:none; font-weight:500">
              View â†’
            </a>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p style="color:var(--muted); padding:1rem 0; font-size:0.9rem">No students registered yet.</p>
    {% endif %}
  </div>

</div>
{% endblock %}